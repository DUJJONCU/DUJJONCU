/* 1. 무료 도트 폰트 갈무리9 불러오기 */
@import url('https://cdn.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css');

/* 1. 뷰포트 설정 최적화 */
:root {
    --solana-purple: #9945FF;
    --solana-green: #14F195;
    --bg-dark: #1a1a2e;
}

body {
    margin: 0;
    padding: 0;
    /* 100vh 대신 100dvh 사용 (모바일 툴바 대응) */
    height: 100dvh;
    background-color: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

/* --- [로그인 화면] --- */
.overlay { 
    position: fixed; 
    inset: 0; 
    background: radial-gradient(circle at center, #1a1a2e 0%, #050505 100%); 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    z-index: 2000; 
}

.login-box { 
    background: rgba(20, 20, 30, 0.95); 
    padding: 40px 30px; 
    border-radius: 24px; 
    text-align: center; 
    width: 300px; 
    border: 2px solid #9945FF; 
    box-shadow: 0 0 30px rgba(153, 69, 255, 0.4); 
    color: white;
}

.login-box input { 
    width: 85%; 
    padding: 14px; 
    margin: 10px 0; 
    background: #0f0f1b;
    border: 1px solid #333; 
    border-radius: 12px; 
    color: #14F195;
    font-family: 'Galmuri9';
}

.login-box button { 
    width: 95%; 
    padding: 16px; 
    background: linear-gradient(135deg, #9945FF 0%, #14F195 100%); 
    color: white; 
    border: none; 
    border-radius: 12px; 
    cursor: pointer; 
    font-family: 'Galmuri9';
    box-shadow: 0 6px 0 #6a2eb3;
    transition: all 0.1s;
    position: relative;
}

.login-box button:active { top: 4px; box-shadow: 0 2px 0 #6a2eb3; }

/* 1. 기본 배경 설정 */
body {
    margin: 0;
    padding: 0;
    background-color: #000; /* 게임 밖 영역은 검은색 */
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100dvh;
    overflow: hidden;
}

/* 2. 메인 컨테이너: 기기 높이에 따라 유연하게 조절 */
#game-container {
    width: 100%;
    max-width: 450px;
    height: 100dvh; 
    background-color: var(--bg-dark);
    display: flex;
    flex-direction: column;
    position: relative;
}

/* 2. 상단 UI (칭호 등) */
#top-ui {
    flex-shrink: 0;
    margin-bottom: 5px;
}

#user-title {
    font-size: 14px;
    font-weight: bold;
}

/* 4. 전광판: 캐릭터 영역 내부 상단에 고정 */
#rank-ticker {
    position: absolute;
    top: 0;
    width: 100%;
    height: 35px;
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid #14F195;
    border-radius: 8px;
    z-index: 10;
    
    /* [핵심 추가] 영역을 벗어나는 텍스트를 숨김 */
    overflow: hidden; 
}

/* 1. 메인 스크린 구조: 세로로 나열하고 간격을 자동으로 배분 */
#screen {
    display: flex;
    flex-direction: column;
    height: 100%; /* 전체 높이 사용 */
    padding: 20px;
    box-sizing: border-box;
    gap: 15px; /* 요소 사이의 간격 유지 */
}

/* 3. 캐릭터 영역: 여기가 가장 중요합니다. */
#character-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    /* justify-content를 center 대신 flex-end로 바꾸고 아래쪽 여백(padding)을 줍니다. */
    justify-content: flex-end; 
    padding-bottom: 15%; /* 이 값을 조절해서 높낮이를 맞추세요 */
    position: relative;
    z-index: 10;
}

/* 6. 하단 UI: 아래쪽에 고정 */
#bottom-ui {
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* 버튼 행: 가로 너비 꽉 차게 */
.button-row {
    display: flex;
    gap: 8px;
    margin-top: 10px;
}

.action-btn {
    flex: 1; /* 버튼 너비 균등 배분 */
    padding: 12px 0;
    font-size: 13px;
    white-space: nowrap;
}

/* 게이지 라벨 (오른쪽 위로 이동) */
.gauge-container {
    margin-bottom: 25px;
}

.gauge-label {
    display: block;
    text-align: right; /* 오른쪽 정렬 */
    font-size: 10px;
    color: #888;
    margin-bottom: 5px;
}

/* 실제 차오르는 바 (보라-민트 그라데이션) */
#exp-bar {
    height: 100%;
    background: linear-gradient(90deg, #9945FF, #14F195);
    width: 0%; /* 초기값 */
    transition: width 0.2s ease-out; /* 부드럽게 움직이게 */
}
#hungry-bar { background: #2ecc71; } /* 초록 */
#mood-bar { background: linear-gradient(90deg, #FF0080, #7928CA); } /* 핑크 -> 보라 */

/* 빈 게이지 배경색 */
.gauge-container {
    background: #2a2a3a;
    height: 12px;
    border-radius: 6px;
}
/* [신규] 자원 대시보드 - 시안성 및 디자인 개선 */
#resource-dashboard {
    display: flex;
    justify-content: space-around;
    align-items: center;
    background: rgba(0, 0, 0, 0.6); /* 더 어둡게 하여 글자 강조 */
    border: 1px solid rgba(153, 69, 255, 0.3); /* 솔라나 보라색 테두리 살짝 */
    border-radius: 12px;
    padding: 12px 5px;
    margin: 5px 10px 15px 10px; /* 주변 요소와 간격 확보 */
    backdrop-filter: blur(8px); /* 배경을 흐리게 만들어 글자 시인성 극대화 */
    -webkit-backdrop-filter: blur(8px);
}

.res-item {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
    justify-content: center;
}

.res-icon { font-size: 18px; }

.res-info { display: flex; flex-direction: column; align-items: flex-start; }

.res-label {
    font-size: 8px;
    color: #9945FF; /* 솔라나 보라 */
    font-weight: bold;
    margin-bottom: 2px;
}

.res-count {
    font-size: 13px;
    font-weight: bold;
    color: #fff;
    text-shadow: 1px 1px 2px #000; /* 검은 그림자로 시인성 보강 */
}

.res-divider {
    width: 1px;
    height: 20px;
    background: rgba(255, 255, 255, 0.1);
}

/* 수치별 강조 색상 */
#food-val { color: #2ecc71; } /* 먹이는 초록 */
#shard-val { color: #14F195; } /* 조각은 솔라나 민트 */

/* 4. 캐릭터 영역: 가장 유연하게 변해야 하는 구간 */
#character-area {
    flex: 1; /* 기기 높이가 길어지면 이 영역이 늘어남 */
    display: flex;
    flex-direction: column;
    justify-content: center; /* 캐릭터 중앙 정렬 */
    align-items: center;
    position: relative;
    min-height: 150px; /* 너무 작아지지 않게 방지 */
}

.ticker-text {
    display: inline-block;
    white-space: nowrap;
    color: #14F195;
    font-size: 12px;
    padding-left: 100%;
    animation: ticker-scroll 40s linear infinite;
}

@keyframes ticker-scroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-200%); }
}

/* [수정] 잠자기 상태: 캐릭터가 검게 타지 않도록 조정 */
.sleeping { 
    /* brightness를 너무 낮추면 이미지 자체가 사라지므로 적절히 조절 */
    filter: grayscale(0.6) brightness(0.8) !important; 
    opacity: 0.6; /* 차라리 투명도를 조절하는 것이 배경색과 잘 섞입니다 */
}

/* [수정] 아담해진 말풍선 디자인 */
#speech-bubble {
    position: absolute;
    top: 135px; /* 60px에서 135px로 내려 캐릭터와 가깝게 배치 */
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.95);
    border: 2px solid #9945FF;
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 11px;
    font-weight: bold;
    color: #333;
    white-space: nowrap;
    max-width: 150px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(153, 69, 255, 0.2);
    z-index: 100;
    display: none;
    pointer-events: none; /* 말풍선 때문에 클릭이 안 되는 현상 방지 */
}

/* 말풍선 꼬리 복구 */
#speech-bubble::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    border-width: 8px 6px 0;
    border-style: solid;
    border-color: #9945FF transparent transparent;
}

/* 게이지 바 */
#bottom-ui { padding: 0 25px; }
.gauge-container { 
    height: 16px; 
    background: #222; 
    border-radius: 8px; 
    margin-bottom: 22px; /* 간격을 살짝 줄여 3개가 다 들어가게 함 */
    position: relative; 
    border: 1px solid #444; 
}
.gauge-fill {
    height: 100%;
    border-radius: 8px;
    transition: width 0.3s ease-out;
}
.gauge-label { position: absolute; width: 100%; top: -20px; right: 0; text-align: right; font-size: 11px; color: #aaa; }

#exp-bar { background: linear-gradient(90deg, #9945FF, #3498db); }
#hungry-bar { background: linear-gradient(90deg, #14F195, #2ecc71); }

/* 하단 버튼 */
.button-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; }
.action-btn { 
    padding: 12px 5px; border: none; border-radius: 12px; color: white; cursor: pointer; 
    font-family: 'Galmuri9'; font-size: 12px; position: relative; transition: 0.1s;
}

.action-btn.feed { background: #2ecc71; box-shadow: 0 5px 0 #27ae60; }
.action-btn.sleep { background: #34495e; box-shadow: 0 5px 0 #2c3e50; }
.action-btn.bag { background: #9b59b6; box-shadow: 0 5px 0 #8e44ad; }

.action-btn:active { top: 5px; box-shadow: none; filter: brightness(1.2); }

/* 모달 */
.modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 400px;      /* 모바일 환경에 맞게 적절한 너비 고정 */
    background: #111;
    border: 2px solid #9945FF;
    border-radius: 20px;
    z-index: 2100;         /* 다른 요소보다 확실히 위에 있게 설정 */
    padding: 20px;
    box-sizing: border-box;
    overflow-x: hidden;    /* 가로 스크롤(흰 바) 방지 */
}
.modal.active { display: block;}
/* 모달 배경 어둡게 처리 (한 번만 존재해야 함) */
.modal-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 2050;
    display: none;
}
.modal-overlay.active { display: block; }
.modal-tab-content div div {
    padding: 6px !important; /* 내부 간격을 줄여서 전체 높이 축소 */
}
.modal-content {
    background: #111;
    color: white;
    width: 85%;
    max-height: 80vh; /* 너무 길어지면 스크롤 */
    overflow-y: auto;
    padding: 20px;
    border-radius: 20px;
    border: 2px solid #9945FF;
    /* 전체 메뉴 제목 크기 조정 */
#game-modal h2 {
    font-size: 16px !important;
    margin-top: 0;
}
}

/* 기타 효과 */
.zzz-particle {
    position: absolute; color: #fff; font-size: 24px; pointer-events: none;
    animation: zzz-fly 2s linear forwards; z-index: 100;
}
@keyframes zzz-fly {
    0% { transform: translate(0, 0) scale(0.5); opacity: 0; }
    100% { transform: translate(30px, -100px) scale(1.2); opacity: 0; }
}

@keyframes flare {
    0% { transform: scale(0) rotate(0deg); opacity: 1; }
    100% { transform: scale(2) rotate(180deg); opacity: 0; }
}

/* 2. 캐릭터 이미지 설정 */
#character-img {
    width: 100px !important;
    height: auto;
    margin-top: 100px; /* 40px에서 100px로 늘려 캐릭터를 아래로 이동 */
    animation: walk-motion 0.8s infinite ease-in-out;
    cursor: pointer;
    position: relative;
    z-index: 999; /* 다른 UI보다 위로 올림 */
    pointer-events: auto !important; /* 클릭 이벤트를 강제로 허용 */
}

/* 잠자기 상태일 때만 희미하게 (평소에는 선명하게) */
.sleeping { 
    filter: grayscale(0.8) brightness(0.5) !important; 
    opacity: 0.7;
}

/* [추가] 레벨 표시 줄이 너무 붙지 않게 여백 조정 */
#level-display {
    color: white;
    font-weight: bold;
}

/* 모달 내 랭킹 리스트 아이템 스타일 */
.rank-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    margin: 4px 0;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid #333;
    font-size: 11px;
}

/* 내 순위 하이라이트 */
.rank-item.my-rank {
    background: rgba(20, 241, 149, 0.1);
    border: 1px solid #14F195;
}

.rank-item.my-rank span {
    color: #14F195;
    font-weight: bold;
}

/* 1, 2, 3위 금/은/동 강조 */
.rank-gold { color: #f1c40f; font-weight: bold; }
.rank-silver { color: #bdc3c7; font-weight: bold; }
.rank-bronze { color: #cd7f32; font-weight: bold; }

@keyframes walk-motion {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

/* 경험치 바 영역 전체 감싸기 */
.exp-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0 10px;
    position: relative;
    width: 100%;
    margin-bottom: 15px;
}
/* 경험치 바 배경 (회색/어두운색) */
.exp-bar-bg {
    position: relative; /* 라벨 배치의 기준 */
    width: 100%;
    flex: 1;
    height: 20px; /* 다른 게이지들과 높이 통일 */
    background: #222;
    border-radius: 10px;
    overflow: hidden; /* 내부 gauge-fill이 삐져나오지 않게 */
    display: flex;
    align-items: center;
    border: 1px solid #444;
}

/* 경험치 바 전용 텍스트 스타일 (이미 mini-label이 있다면 공통 사용 가능) */
#exp-label {
    position: absolute;
    width: 100%;
    text-align: center;
    font-size: 10px;
    font-weight: bold;
    color: #ffffff;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    z-index: 10;
    pointer-events: none;
}

/* 경험치 텍스트 위치 및 스타일 */
.exp-text {
    display: block;
    text-align: right;
    font-size: 10px;
    color: #14F195;
    margin-top: 4px;
    font-family: 'Galmuri9', sans-serif;
}

/* 게이지 두 개를 가로로 합침 */
.status-row {
    display: flex;
    gap: 5px;
    padding: 5px 10px;
}

.mini-gauge {
    position: relative;
    flex: 1;
    height: 18px; /* 가독성을 위해 높이를 살짝 키움 */
    background: #222;
    border-radius: 9px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* 게이지 바 컨테이너 보정 */
.mini-gauge {
    position: relative; /* 자식 요소인 .mini-label의 기준점이 됨 */
    flex: 1;
    height: 16px; 
    background: #222;
    border-radius: 8px;
    overflow: hidden;
    display: flex; /* 내부 요소 정렬 */
    align-items: center;
}

/* 게이지 바 내부 글자 스타일 */
.mini-label {
    position: absolute; /* 게이지 바 위에 겹치도록 설정 */
    width: 100%;
    text-align: center;
    font-size: 10px;
    font-weight: bold;
    color: #ffffff; /* 흰색으로 고정 */
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8); /* 어떤 배경색에서도 잘 보이게 그림자 추가 */
    z-index: 10; /* 게이지(gauge-fill)보다 위에 오도록 설정 */
    pointer-events: none; /* 글자가 마우스 클릭을 방해하지 않게 함 */
}

/* 게이지가 차오르는 영역 */
.gauge-fill {
    height: 100%;
    border-radius: 8px;
    transition: width 0.3s ease;
}

/* 콤보 텍스트 스타일 정의 */
/* 클래스(.)가 아니라 아이디(#)로 변경하세요 */
#combo-display {
    position: absolute;
    top: 100px; /* 전광판(35px) 아래, 캐릭터(100px) 주변 위치 */    left: 50%;
    transform: translate(-50%, -50%); /* 기준점을 글자 중앙으로 설정 */
    font-family: 'DungGeunMo', 'Courier New', monospace;
    font-size: 20px;
    font-weight: bold;
    color: #FFD700;
    text-align: center;
    z-index: 1000;
    pointer-events: none;
    display: none;
    /* 레트로 도트 외곽선 효과 */
    text-shadow: 
        -2px -2px 0 #000,  
         2px -2px 0 #000,
        -2px  2px 0 #000,
         2px  2px 0 #000,
         3px  3px 0 rgba(0,0,0,0.5); /* 그림자 추가 */
    
    /* 약간의 기울기 추가로 역동성 부여 */
    font-style: italic;
}

/* 콤보가 터질 때 톡톡 튀는 애니메이션 */
@keyframes combo-pop {
    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}

/* 날씨 입자 기본 스타일 */
.weather-particle {
    position: absolute;
    top: -20px;
    z-index: 1;
    pointer-events: none;
    opacity: 0.6;
    animation: weather-fall linear infinite;
}

@keyframes walk-motion {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

#character-img {
    cursor: pointer;
    transition: transform 0.1s;
    user-select: none;
    -webkit-tap-highlight-color: transparent; /* 모바일 터치 시 파란 박스 제거 */
}