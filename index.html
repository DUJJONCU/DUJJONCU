<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ë‘ì«€ì¿  ì„œë°”ì´ë²„: ê°€ë¡œëª¨ë“œ</title>
    <style>
        * { touch-action: none; -webkit-user-select: none; user-select: none; box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial', sans-serif; }
        canvas { display: block; }

        /* ì„¸ë¡œ ëª¨ë“œì¼ ë•Œ ì•ˆë‚´ì°½ */
        #rotate-notice {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #1a1a1a; color: white; z-index: 9999;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            text-align: center;
        }
        @media (orientation: portrait) {
            #rotate-notice { display: flex; }
        }

        /* UI ë ˆì´ì•„ì›ƒ - ê°€ë¡œ ìµœì í™” */
        #ui-top { position: absolute; top: env(safe-area-inset-top, 20px); left: 20px; color: white; pointer-events: none; z-index: 10; }
        #stage-info { font-size: 22px; color: #ffee00; font-weight: bold; text-shadow: 2px 2px #000; }
        #exp-bar { width: 250px; height: 10px; background: #333; border: 1.5px solid #fff; margin-top: 5px; border-radius: 5px; }
        #exp-inner { width: 0%; height: 100%; background: #00ccff; border-radius: 3px; }

        /* ì¡°ì´ìŠ¤í‹± (ì¢Œì¸¡ í•˜ë‹¨) */
        #joy-base { position: absolute; bottom: 40px; left: 60px; width: 110px; height: 110px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); }
        #joy-stick { position: absolute; top: 30px; left: 30px; width: 50px; height: 50px; background: rgba(0,255,204,0.4); border-radius: 50%; box-shadow: 0 0 15px #00ffcc; }

        /* í•„ì‚´ê¸° ë²„íŠ¼ (ìš°ì¸¡ í•˜ë‹¨) */
        #ult-btn { 
            position: absolute; bottom: 45px; right: 60px; width: 90px; height: 90px; 
            background: rgba(255,68,68,0.15); border: 4px solid #ff4444; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; color: white; 
            font-weight: bold; opacity: 0.4; transition: 0.3s;
        }
        #ult-btn.ready { opacity: 1; background: #ff4444; box-shadow: 0 0 25px #ff4444; transform: scale(1.1); }

        /* ìŠ¤í‚¬ íŒì—… */
        #level-up-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 100; gap: 20px; }
        .skill-card { background: #222; color: white; padding: 25px; width: 200px; border: 2px solid #ffee00; border-radius: 15px; text-align: center; cursor: pointer; transition: 0.2s; }
        .skill-card:active { transform: scale(0.95); background: #444; }
    </style>
</head>
<body>
    <div id="rotate-notice">
        <div style="font-size: 50px;">ğŸ”„</div>
        <p>ê¸°ê¸°ë¥¼ ê°€ë¡œë¡œ ëŒë ¤ì£¼ì„¸ìš”!<br>ì¾Œì í•œ ê²Œì„ í”Œë ˆì´ë¥¼ ìœ„í•´ ê°€ë¡œ ëª¨ë“œê°€ í•„ìˆ˜ì…ë‹ˆë‹¤.</p>
    </div>

    <div id="ui-top">
        <div id="stage-info">STAGE <span id="cur-stage">1</span> | LV <span id="cur-lv">1</span></div>
        <div id="exp-bar"><div id="exp-inner"></div></div>
        <div style="font-size: 14px; margin-top:5px; color:#ccc;">ë³´ìŠ¤ ë“±ì¥ê¹Œì§€: <span id="kill-count">30</span></div>
    </div>

    <div id="level-up-ui">
        <div class="skill-card" onclick="selectSkill('dmg')"><h3>ê³µê²©ë ¥</h3><p>ë°ë¯¸ì§€ ê°•í™”</p></div>
        <div class="skill-card" onclick="selectSkill('spd')"><h3>ì‹ ì†</h3><p>ì´ë™ì†ë„ ì¦ê°€</p></div>
        <div class="skill-card" onclick="selectSkill('fire')"><h3>ì—°ì‚¬</h3><p>ê³µê²©ì†ë„ ì¦ê°€</p></div>
    </div>

    <div id="joy-base"><div id="joy-stick"></div></div>
    <div id="ult-btn">ULTIMATE</div>

    <canvas id="gameCanvas"></canvas>

    <script>
        // í™”ë©´ ê°€ë¡œ ëª¨ë“œ ì ê¸ˆ ì‹œë„ (ì¼ë¶€ ìµœì‹  ë¸Œë¼ìš°ì € ì§€ì›)
        if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('landscape').catch(e => console.log("Orientation lock not supported"));
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- ê²Œì„ ì—”ì§„ ë³€ìˆ˜ ---
        let stage = 1, lv = 1, exp = 0, expNext = 5, kills = 30, isPaused = false;
        let pDmg = 1, pSpd = 5, pFireRate = 30;
        const player = { x: 0, y: 0, size: 25 };
        const camera = { x: 0, y: 0 };
        const enemies = [], bullets = [], orbs = [];
        let moveX = 0, moveY = 0, isJoy = false;

        // ì¡°ì´ìŠ¤í‹± ë¡œì§ (ê°€ë¡œ ëª¨ë“œ í„°ì¹˜ ìµœì í™”)
        const joyBase = document.getElementById('joy-base');
        const joyStick = document.getElementById('joy-stick');
        const updateJoy = (e) => {
            if(!isJoy) return;
            const t = e.touches ? e.touches[0] : e;
            const r = joyBase.getBoundingClientRect();
            const dx = t.clientX - (r.left + r.width/2), dy = t.clientY - (r.top + r.height/2);
            const dist = Math.min(Math.sqrt(dx*dx + dy*dy), 55);
            const ang = Math.atan2(dy, dx);
            const sx = Math.cos(ang) * dist, sy = Math.sin(ang) * dist;
            joyStick.style.transform = `translate(${sx}px, ${sy}px)`;
            moveX = sx / 55; moveY = sy / 55;
        };
        joyBase.addEventListener('touchstart', (e) => { isJoy = true; updateJoy(e); });
        window.addEventListener('touchmove', updateJoy);
        window.addEventListener('touchend', () => { isJoy = false; moveX = 0; moveY = 0; joyStick.style.transform = 'translate(0,0)'; });

        // ìŠ¤í‚¬ ì‹œìŠ¤í…œ
        function selectSkill(type) {
            if(type === 'dmg') pDmg += 1;
            if(type === 'spd') pSpd += 0.8;
            if(type === 'fire') pFireRate = Math.max(5, pFireRate - 4);
            isPaused = false;
            document.getElementById('level-up-ui').style.display = 'none';
        }

        // ì  ìƒì„± (ê°€ë¡œ ì‹œì•¼ ë°–ì—ì„œ ìƒì„±)
        function spawnEnemy(isBoss = false) {
            const ang = Math.random() * Math.PI * 2;
            const dist = Math.max(canvas.width, canvas.height) * 0.6;
            enemies.push({
                x: player.x + Math.cos(ang) * dist,
                y: player.y + Math.sin(ang) * dist,
                hp: isBoss ? (20 + stage * 15) : (1 + stage * 0.2),
                speed: isBoss ? 1.0 : (0.7 + (stage * 0.05) + Math.random() * 0.3),
                size: isBoss ? 55 : 18,
                isBoss: isBoss,
                color: isBoss ? '#ff00ff' : `hsl(${stage * 20 % 360}, 60%, 50%)`
            });
        }

        function update() {
            if(isPaused) return;

            player.x += moveX * pSpd;
            player.y += moveY * pSpd;
            camera.x = player.x - canvas.width/2;
            camera.y = player.y - canvas.height/2;

            if(enemies.length < 12 + stage && kills > 0 && !enemies.some(e=>e.isBoss)) spawnEnemy(false);

            if(Date.now() % 500 < 50 && enemies.length > 0) {
                 const target = enemies[0];
                 const ang = Math.atan2(target.y - player.y, target.x - player.x);
                 bullets.push({x: player.x, y: player.y, vx: Math.cos(ang)*9, vy: Math.sin(ang)*9});
            }

            enemies.forEach((e, ei) => {
                const ang = Math.atan2(player.y - e.y, player.x - e.x);
                e.x += Math.cos(ang) * e.speed;
                e.y += Math.sin(ang) * e.speed;

                bullets.forEach((b, bi) => {
                    if(Math.hypot(b.x - e.x, b.y - e.y) < e.size) {
                        e.hp -= pDmg;
                        bullets.splice(bi, 1);
                        if(e.hp <= 0) {
                            orbs.push({x: e.x, y: e.y});
                            if(e.isBoss) { stage++; kills = 30; document.getElementById('cur-stage').innerText = stage; }
                            else if(kills > 0) { kills--; if(kills === 0) spawnEnemy(true); }
                            document.getElementById('kill-count').innerText = kills;
                            enemies.splice(ei, 1);
                        }
                    }
                });
            });

            orbs.forEach((o, oi) => {
                if(Math.hypot(player.x - o.x, player.y - o.y) < 40) {
                    orbs.splice(oi, 1);
                    exp++;
                    if(exp >= expNext) {
                        lv++; exp = 0; expNext += 4;
                        isPaused = true;
                        document.getElementById('cur-lv').innerText = lv;
                        document.getElementById('level-up-ui').style.display = 'flex';
                    }
                    document.getElementById('exp-inner').style.width = (exp/expNext*100) + "%";
                }
            });

            bullets.forEach((b, i) => { b.x += b.vx; b.y += b.vy; });
        }

        function draw() {
            ctx.fillStyle = '#0a0a0a';
            ctx.fillRect(0,0,canvas.width, canvas.height);
            
            // ë°”ë‹¥ ê·¸ë¦¬ë“œ
            ctx.strokeStyle = '#1a1a1a';
            ctx.lineWidth = 2;
            for(let x = -camera.x % 70; x < canvas.width; x += 70) {
                ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
            }
            for(let y = -camera.y % 70; y < canvas.height; y += 70) {
                ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
            }

            orbs.forEach(o => { ctx.fillStyle = '#00ccff'; ctx.beginPath(); ctx.arc(o.x-camera.x, o.y-camera.y, 4, 0, Math.PI*2); ctx.fill(); });
            enemies.forEach(e => { 
                ctx.fillStyle = e.color; 
                ctx.beginPath(); ctx.arc(e.x-camera.x, e.y-camera.y, e.size, 0, Math.PI*2); ctx.fill(); 
                if(e.isBoss) {
                    ctx.strokeStyle = 'white'; ctx.lineWidth = 2; ctx.stroke();
                }
            });
            bullets.forEach(b => { ctx.fillStyle = 'yellow'; ctx.beginPath(); ctx.arc(b.x-camera.x, b.y-camera.y, 4, 0, Math.PI*2); ctx.fill(); });
            
            // í”Œë ˆì´ì–´
            ctx.fillStyle = '#00ffcc';
            ctx.beginPath(); ctx.arc(canvas.width/2, canvas.height/2, player.size, 0, Math.PI*2); ctx.fill();
        }

        function loop() { update(); draw(); requestAnimationFrame(loop); }
        loop();
    </script>
</body>
</html>
